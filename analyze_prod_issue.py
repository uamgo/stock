#!/usr/bin/env python3
"""
模拟生产环境问题：检查为什么生产环境显示的热度排名与本地不同
"""

import numpy as np
import pandas as pd

def simulate_production_issue():
    """模拟生产环境问题"""
    
    print("🔍 模拟生产环境问题...")
    
    # 生产环境的TOP5结果
    prod_results = [
        {"名称": "昨日连板_含一字", "涨跌幅": 3.80, "热度": 42.6},
        {"名称": "雅下水电概念", "涨跌幅": 3.19, "热度": 41.4},
        {"名称": "CRO", "涨跌幅": 1.42, "热度": 37.8},
        {"名称": "CAR-T细胞疗法", "涨跌幅": 1.15, "热度": 37.3},
        {"名称": "高带宽内存", "涨跌幅": 1.04, "热度": 37.1},
    ]
    
    # 本地的TOP5结果
    local_results = [
        {"名称": "券商概念", "涨跌幅": 0.51, "热度": 67.3},
        {"名称": "互联金融", "涨跌幅": -0.07, "热度": 65.9},
        {"名称": "科创板做市商", "涨跌幅": 0.95, "热度": 60.1},
        {"名称": "参股期货", "涨跌幅": -0.20, "热度": 58.3},
        {"名称": "高带宽内存", "涨跌幅": 1.04, "热度": 57.3},
    ]
    
    print("🔥 生产环境TOP5:")
    for i, result in enumerate(prod_results, 1):
        print(f"  {i}. {result['名称']:<20} | 涨跌: {result['涨跌幅']:>6.2f}% | 热度: {result['热度']:>5.1f}分")
    
    print("\n🔥 本地环境TOP5:")
    for i, result in enumerate(local_results, 1):
        print(f"  {i}. {result['名称']:<20} | 涨跌: {result['涨跌幅']:>6.2f}% | 热度: {result['热度']:>5.1f}分")
    
    # 分析问题
    print("\n📊 问题分析:")
    print("1. 高带宽内存在两个环境中:")
    print(f"   - 生产环境: 涨跌幅1.04%, 热度37.1分")  
    print(f"   - 本地环境: 涨跌幅1.04%, 热度57.3分")
    print("   💡 涨跌幅相同但热度差了20分！说明其他维度数据不同")
    
    print("\n2. 本地环境优势概念在生产环境中的表现:")
    print("   - 券商概念/互联金融等高分概念在生产环境中可能根本不在TOP5")
    print("   - 这说明生产环境获取的原始数据与本地不同")
    
    print("\n🚨 可能的原因:")
    print("1. 🕐 数据获取时间差异：生产环境可能在不同时间获取数据")
    print("2. 🌐 网络环境差异：生产环境可能使用了不同的代理或网络")
    print("3. 💾 缓存问题：生产环境可能使用了旧的缓存数据")
    print("4. 🔧 代码版本差异：生产环境可能没有使用最新的热度计算逻辑")
    print("5. 📊 数据源差异：东方财富API在不同时间/地点返回不同数据")

if __name__ == "__main__":
    simulate_production_issue()
